@using ChatApplication.Blazor.Services
@using ChatApplication.Blazor.Services.Interfaces

@inject ChatAuthenticationStateProvider AuthenticationStateProvider;
@inject IAuthService AuthService;

@if (_authenticated)
{
    <MudNavMenu>
            <MudNavLink Href="/" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.Home">Home</MudNavLink>
            <MudNavLink Href="/chats" Icon="@Icons.Material.Filled.Storage">Chats</MudNavLink>
            <MudNavLink Href="/users" Icon="@Icons.Material.Filled.Storage">Users</MudNavLink>
            <MudNavLink Href="/changePassword" Icon="@Icons.Material.Filled.Storage">Change password</MudNavLink>
    </MudNavMenu>
}


@code {
    private bool _authenticated = false;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();

            if (authState.User.Identity != null)
            {
                _authenticated = authState.User.Identity.IsAuthenticated;
            }
            
            StateHasChanged();
        }
    }
}